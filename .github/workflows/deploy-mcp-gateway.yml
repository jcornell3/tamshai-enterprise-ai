# Incremental Deployment: MCP Gateway Service
#
# Uses reusable workflow for deployment logic.
# Triggers on changes to services/mcp-gateway/

name: Deploy MCP Gateway

on:
  push:
    branches: [main]
    paths:
      - 'services/mcp-gateway/**'
      - '.github/workflows/deploy-mcp-gateway.yml'

  workflow_dispatch:
    inputs:
      environment:
        description: 'Target environment'
        required: true
        type: choice
        options:
          - staging
          - production
        default: 'staging'
      rollback:
        description: 'Rollback to previous version'
        required: false
        type: boolean
        default: false

concurrency:
  group: deploy-mcp-gateway-${{ github.event.inputs.environment || 'staging' }}
  cancel-in-progress: false

permissions:
  contents: read
  deployments: write

jobs:
  deploy:
    uses: ./.github/workflows/deploy-mcp-service.yml
    with:
      service-name: mcp-gateway
      health-check-port: '3100'
      environment: ${{ github.event.inputs.environment || 'staging' }}
      rollback: ${{ github.event.inputs.rollback == 'true' }}
    secrets:
      VPS_SSH_KEY: ${{ secrets.VPS_SSH_KEY }}
      VPS_HOST: ${{ secrets.VPS_HOST }}
      VPS_SSH_USER: ${{ secrets.VPS_SSH_USER }}
